<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>sak96-blog - wsl</title><link href="https://sak96.github.io/" rel="alternate"></link><link href="https://sak96.github.io/feeds/wsl.atom.xml" rel="self"></link><id>https://sak96.github.io/</id><updated>2020-10-14T00:00:00+01:00</updated><entry><title>WSL2 with GUI without Admin</title><link href="https://sak96.github.io/wsl2-with-gui-without-admin.html" rel="alternate"></link><published>2020-10-14T00:00:00+01:00</published><updated>2020-10-14T00:00:00+01:00</updated><author><name>sak96</name></author><id>tag:sak96.github.io,2020-10-14:/wsl2-with-gui-without-admin.html</id><summary type="html">&lt;p&gt;My experience setting up WSL2 along with problems and solutions&lt;/p&gt;</summary><content type="html">&lt;p&gt;WSL or windows subsystem for linux is way to use linux interface on windows machine.
WSL2 comes with better support for filesystem and network for linux interface.
Previous &lt;a href="https://sak96.github.io/wsl1-with-xserver-without-admin.html"&gt;Article&lt;/a&gt; describes wsl1 setup.&lt;/p&gt;
&lt;p&gt;WSL2 solves the &lt;a href="https://discourse.ubuntu.com/t/ubuntu-20-04-and-wsl-1/15291" title="Ubuntu sleep"&gt;sleep issue&lt;/a&gt; in Ubuntu wsl with updated glibc.
WSL2 comes with not only comes with pros but also it's own share of issues.
For WSL2 using Ubuntu 20.04 seemed easy, keeping WSL1 Debian setup as my backup.
This Article walk through various problem faced and solutions if found.&lt;/p&gt;
&lt;h2&gt;VPN and MTU&lt;/h2&gt;
&lt;p&gt;VPN MTU was less that the WSL2 eth0 network interface.
This caused network connection to hang on large transfers, more detail &lt;a href="https://github.com/microsoft/WSL/issues/5068#issuecomment-683917384" title="MTU VPN issue"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The VPN MTU can be accessed using following command.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;netsh&lt;span class="w"&gt; &lt;/span&gt;interface&lt;span class="w"&gt; &lt;/span&gt;ipv4&lt;span class="w"&gt; &lt;/span&gt;show&lt;span class="w"&gt; &lt;/span&gt;subinterface
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;p&gt;Setting same mtu to eth0 can be done as follows.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ip&lt;span class="w"&gt; &lt;/span&gt;link&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;mtu&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;mtu_vpn&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;dev&lt;span class="w"&gt; &lt;/span&gt;eth0
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;p&gt;Single line command will be as follows.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;%bash&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sudo ip link set mtu $($(wslpath &amp;#39;%windir%\system32&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;etsh.exe&amp;#39;) interface ipv4 show subinterface | $(wslpath &amp;#39;%windir%\system32&lt;/span&gt;&lt;span class="se"&gt;\f&lt;/span&gt;&lt;span class="s"&gt;indstr.exe&amp;#39;) /i vpn   | grep -i vpn | sed &amp;#39;s/^\s\+//g&amp;#39;|  cut -f 1 -d &amp;#39; &amp;#39;) dev eth0&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;h2&gt;Network and GUI&lt;/h2&gt;
&lt;p&gt;Using &lt;a href="https://sourceforge.net/projects/vcxsrv/" title="Visual C++ X server"&gt;vcXsrv&lt;/a&gt; seemed a fair choice for Xserver to use GUI.
WSL2 restricts on using windows Network (localhost) on WSL2.
vcXsrv could no longer be assessed by WSL2 for displaying GUI.
Admin was required to add firewall allow rule to allow such connection.&lt;/p&gt;
&lt;p&gt;Solution was to use &lt;code&gt;socat&lt;/code&gt; to connect from WSL2 to Windows as mentioned &lt;a href="https://github.com/microsoft/WSL/issues/4619#issuecomment-678652118" title="Socat WSL2 to Windows"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install socat in ubuntu using &lt;code&gt;apt&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Download socat for window from &lt;a href="https://sourceforge.net/projects/unix-utils/files/socat/" title="Socat for windows"&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Set Downloaded socat path in &lt;code&gt;%socat%&lt;/code&gt; varrable and run below command in cmd.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;start&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;socat&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/min&lt;span class="w"&gt;  &lt;/span&gt;ubuntu2004.exe&lt;span class="w"&gt; &lt;/span&gt;-c&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;socat UNIX-LISTEN:/tmp/.X11-unix/X0,fork exec:\&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;wslpath&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;%socat%&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt; - TCP\:localhost\:6000\&amp;quot;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;h2&gt;Xserver to Xrdp&lt;/h2&gt;
&lt;p&gt;The above solution was slow. The other solution was to use ssh tunnel or use Xrdp.
Install Xrdp and running it was simple, but automating is a challenge to be done.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Installation Command&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;--no-install-recommends&lt;span class="w"&gt; &lt;/span&gt;xrdp&lt;span class="w"&gt; &lt;/span&gt;xrdp-xorg

&lt;span class="c1"&gt;# Starting Service (Yet to automate)&lt;/span&gt;
service&lt;span class="w"&gt; &lt;/span&gt;xrdp&lt;span class="w"&gt; &lt;/span&gt;start
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;EDIT&lt;/strong&gt; Found a better way to use run start the service.
You can open run menu from &lt;code&gt;Win+r&lt;/code&gt;.
Type &lt;code&gt;shell:startup&lt;/code&gt; and press &lt;code&gt;enter&lt;/code&gt;.
Add a bat file to start xrdp at startup.
Note: sleep is required other wise xrdp does not startup&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wsl&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;service&lt;span class="w"&gt; &lt;/span&gt;xrdp&lt;span class="w"&gt; &lt;/span&gt;start&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sleep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;p&gt;Rdp using the ip address. More details &lt;a href="https://stackoverflow.com/a/26694162" title="Get Ip Address"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ip&lt;span class="w"&gt; &lt;/span&gt;-4&lt;span class="w"&gt; &lt;/span&gt;addr&lt;span class="w"&gt; &lt;/span&gt;show&lt;span class="w"&gt; &lt;/span&gt;eth0&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;-oP&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;(?&amp;lt;=inet\s)\d+(\.\d+){3}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;EDIT&lt;/strong&gt;
Found a better way to use run the above command.
I had rdp connection file from my last connection say &lt;code&gt;~/rdp.rdp&lt;/code&gt;.
The following command open rdp connection using the above file from wsl.
You can add this to bat file or add alias to the same.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mstsc.exe&lt;span class="w"&gt; &lt;/span&gt;/v:&lt;span class="k"&gt;$(&lt;/span&gt;hostname&lt;span class="w"&gt; &lt;/span&gt;-I&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;wslpath&lt;span class="w"&gt; &lt;/span&gt;-w&lt;span class="w"&gt; &lt;/span&gt;~/rdp.rdp&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;h2&gt;Xrdp and Sound&lt;/h2&gt;
&lt;p&gt;To use sound on Xrdp with pulseaudio, some libraries are required.
Copying the library from &lt;a href="https://github.com/DesktopECHO/xWSL" title="Xrdp PulseAudio"&gt;here&lt;/a&gt; helped.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# adding libraries&lt;/span&gt;
&lt;span class="n"&gt;git&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clone&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;github&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;DesktopECHO&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;xWSL&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;xWSL&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dist&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;xrdp&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;pulseaudio&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;installer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;

&lt;span class="c1"&gt;# restarting pulseaudio&lt;/span&gt;
&lt;span class="n"&gt;pulseaudio&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;
&lt;span class="n"&gt;pulseaudio&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;D&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;h2&gt;Teams and WSL2&lt;/h2&gt;
&lt;p&gt;Teams is messaging platform by microsoft whose installation instruction are &lt;a href="https://docs.microsoft.com/en-us/microsoftteams/get-clients" title="Ms Teams Install"&gt;here&lt;/a&gt;.
To get working in WSL2 required installation of couple of missing dependencies.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# install teams&lt;/span&gt;
curl&lt;span class="w"&gt; &lt;/span&gt;https://packages.microsoft.com/keys/microsoft.asc&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;apt-key&lt;span class="w"&gt; &lt;/span&gt;add&lt;span class="w"&gt; &lt;/span&gt;-
sudo&lt;span class="w"&gt; &lt;/span&gt;sh&lt;span class="w"&gt; &lt;/span&gt;-c&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;echo &amp;quot;deb [arch=amd64] https://packages.microsoft.com/repos/ms-teams stable main&amp;quot; &amp;gt; /etc/apt/sources.list.d/teams.list&amp;#39;&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;update
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;teams

&lt;span class="c1"&gt;# install missing dependencies&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;libsecret-1-0&lt;span class="w"&gt; &lt;/span&gt;chromium-codecs-ffmpeg
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;h2&gt;Automating at Startup&lt;/h2&gt;
&lt;p&gt;Setting mtu and booting up xrdp every time is annoying.
For mtu setting least value of vpn and network works without trouble.
Xrdp startup command needs a small sleep to ensure that command really worked.&lt;/p&gt;
&lt;p&gt;To make this work open run menu by pressing &lt;code&gt;win&lt;/code&gt; + &lt;code&gt;R&lt;/code&gt;.
Type &lt;code&gt;shell:startup&lt;/code&gt; to open the startup folder.
Add the following script in a file &lt;code&gt;wsl.bat&lt;/code&gt; in the folder.
Replace &lt;code&gt;$least_value&lt;/code&gt; with least value of the mtu.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wsl&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;ip&lt;span class="w"&gt; &lt;/span&gt;link&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;mtu&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$least_value&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;dev&lt;span class="w"&gt; &lt;/span&gt;eth0&lt;span class="p"&gt;;&lt;/span&gt;
wsl&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;service&lt;span class="w"&gt; &lt;/span&gt;xrdp&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sleep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;p&gt;Make following &lt;code&gt;rdp.bat&lt;/code&gt; file in your desktop for faster launch of rdp.
Double clicking on this file will start cmd program which launches rdp.
The cmd prompt can be closed after some time.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wsl&lt;span class="w"&gt; &lt;/span&gt;mstsc.exe&lt;span class="w"&gt; &lt;/span&gt;/v:&lt;span class="k"&gt;$(&lt;/span&gt;hostname&lt;span class="w"&gt; &lt;/span&gt;-I&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;wslpath&lt;span class="w"&gt; &lt;/span&gt;-w&lt;span class="w"&gt; &lt;/span&gt;~/rdp.rdp&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</content><category term="wsl"></category><category term="story"></category><category term="wsl"></category><category term="linux"></category></entry><entry><title>WSL1 with Xserver without Admin</title><link href="https://sak96.github.io/wsl1-with-xserver-without-admin.html" rel="alternate"></link><published>2020-08-20T00:00:00+01:00</published><updated>2020-08-20T00:00:00+01:00</updated><author><name>sak96</name></author><id>tag:sak96.github.io,2020-08-20:/wsl1-with-xserver-without-admin.html</id><summary type="html">&lt;p&gt;My experience setting up WSL1 along with problems and solutions&lt;/p&gt;</summary><content type="html">&lt;p&gt;WSL or windows subsystem for linux is way to use linux interface on windows machine.
This post is journey of setup of WSL1 environment and not WSL2. 
Two parts that are touched are &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Debian over Ubuntu &lt;/li&gt;
&lt;li&gt;GUI setup&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;Debian over Ubuntu&lt;/h1&gt;
&lt;p&gt;Ubuntu 20.04 had few bugs when on WSL1.
Ubuntu 18.04 came with python2.
Debian 10.5 was slim, was easy to install firefox-esr.&lt;/p&gt;
&lt;h2&gt;Size&lt;/h2&gt;
&lt;p&gt;Debian was slimmer than both version of Ubuntu.&lt;/p&gt;
&lt;h2&gt;Cannot Sleep&lt;/h2&gt;
&lt;p&gt;In Ubuntu 20.04, glibc version is 2.31 which breaks sleep.
Error which shows up is &lt;code&gt;sleep: cannot read realtime clock: Invalid argument&lt;/code&gt;.
According to &lt;a href="https://discourse.ubuntu.com/t/ubuntu-20-04-and-wsl-1/15291" title="Ubuntu sleep"&gt;thread&lt;/a&gt; the fix wait for microsoft wsl patch.
It mentions that Ubuntu 18.04 in WSL1 or using WSL2 will avoid this.&lt;/p&gt;
&lt;p&gt;In Debian 10.5 WSL in microsoft store the glibc version is older.
Sleep work fine with this version of glibc in WSL1.&lt;/p&gt;
&lt;h2&gt;Python3&lt;/h2&gt;
&lt;p&gt;One of the main reason of not using Ubuntu 18.04 is it comes with python2.
Debian 10.5 did not come with python2 hence no major headache on this part.&lt;/p&gt;
&lt;p&gt;Though you could set your /bin/python to python3 (and pip) as follows&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# For Ubuntu&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;update-alternatives&lt;span class="w"&gt; &lt;/span&gt;--install&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/python&lt;span class="w"&gt; &lt;/span&gt;python&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/python3&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;update-alternatives&lt;span class="w"&gt; &lt;/span&gt;--install&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/pip&lt;span class="w"&gt; &lt;/span&gt;pip&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/pip3&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;h2&gt;Firefox&lt;/h2&gt;
&lt;p&gt;In Debian WSL installing and installing firefox-esr worked without issue.
There were few issue in case of Ubuntu 20.04 but not sure of Ubuntu 18.04.
Also Ubuntu requires you to add repository to use firefox-esr.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# For Ubuntu&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;--no-install-recommends&lt;span class="w"&gt; &lt;/span&gt;software-properties-common
sudo&lt;span class="w"&gt; &lt;/span&gt;add-apt-repository&lt;span class="w"&gt; &lt;/span&gt;ppa:mozillateam/ppa
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;update
sudo&lt;span class="w"&gt; &lt;/span&gt;apt&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;--no-install-recommends&lt;span class="w"&gt; &lt;/span&gt;firefox-esr&lt;span class="w"&gt; &lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;update-alternatives&lt;span class="w"&gt; &lt;/span&gt;--install&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/firefox&lt;span class="w"&gt; &lt;/span&gt;firefox&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/firefox-esr&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;h2&gt;Downside&lt;/h2&gt;
&lt;p&gt;Debian 10.5 contains vim and neo vim version do not play well with popup handling.
Also i3status used to fail continuously with segmentation violation. 
Fix is using deb package for i3status from &lt;a href="https://packages.debian.org/buster/i3status" title="i3 status package"&gt;next version&lt;/a&gt; of Debian.&lt;/p&gt;
&lt;h1&gt;GUI Setup&lt;/h1&gt;
&lt;p&gt;WSL does not ship with xserver. Xserver is what handle GUI. I use &lt;a href="https://sourceforge.net/projects/vcxsrv/" title="Visual C++ X server"&gt;vcXsrv&lt;/a&gt; as Xserver.&lt;/p&gt;
&lt;h2&gt;Working&lt;/h2&gt;
&lt;p&gt;Start vcXsrv which will run Xserver.
Run GUI software like i3 providing the servers details.&lt;/p&gt;
&lt;h2&gt;Non Admin&lt;/h2&gt;
&lt;p&gt;I don't like running softwares as admin even if it is for installation.
In wiki for vcXsrv we have &lt;a href="https://sourceforge.net/p/vcxsrv/wiki/Making%20Portable/" title="portable xcXsrv"&gt;section&lt;/a&gt; to make it portable.
It requires the software to be extracted as 7z file.
Followed by removal of "$PLUGINSDIR" folder.
The extracted path used here is &lt;code&gt;%userprofile%\AppData\Local\VcXsrv\&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Shortcut&lt;/h2&gt;
&lt;p&gt;I wanted to run the server and i3 without on single click.
Simple script crafted by hand is below.&lt;/p&gt;
&lt;p&gt;Note: First run after boot will fail. Kill vcXsrv and retry.&lt;/p&gt;
&lt;p&gt;Setting up variables.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;echo&lt;/span&gt; off
&lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;command=nohup /usr/bin/i3 &amp;gt;/dev/null 2&amp;gt;&amp;amp;1&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;windowmode&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;nodecoration
&lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;dispnum&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;1
&lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;bash&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;%userprofile%&lt;/span&gt;\AppData\Local\Microsoft\WindowsApps\debian.exe
&lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;vcxsrvexec&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;%userprofile%&lt;/span&gt;\appdata\local\vcxsrv\vcxsrv.exe
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;


&lt;p&gt;Running the shortcut.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;table class="codehilitetable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;
&lt;span class="normal"&gt;9&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;start&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Xserver&amp;quot;&lt;/span&gt; /D &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%userprofile%&lt;/span&gt;&lt;span class="s2"&gt;\AppData\Local\VcXsrv\&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;%vcxsrvexec%&lt;/span&gt; &lt;span class="se"&gt;^&lt;/span&gt;
&lt;span class="se"&gt;:&lt;/span&gt;&lt;span class="nv"&gt;%dispnum%&lt;/span&gt; -ac -terminate -lesspointer -&lt;span class="nv"&gt;%windowmode%&lt;/span&gt; -clipboard -wgl &lt;span class="se"&gt;^&lt;/span&gt;
&lt;span class="se"&gt;-&lt;/span&gt;logfile &lt;span class="nv"&gt;%userprofile%&lt;/span&gt;\appdata\local\vcxsrv\vcxsrv.log

&lt;span class="k"&gt;IF&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%bash%&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
  &lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;bash&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;%systemroot%&lt;/span&gt;\system32\bash.exe
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;localhost:&lt;span class="nv"&gt;%dispnum%&lt;/span&gt;.0
&lt;span class="nv"&gt;%bash%&lt;/span&gt; -c &lt;span class="s2"&gt;&amp;quot;export DISPLAY=&lt;/span&gt;&lt;span class="nv"&gt;%disp%&lt;/span&gt;&lt;span class="s2"&gt;; cd $HOME; &lt;/span&gt;&lt;span class="nv"&gt;%command%&lt;/span&gt;&lt;span class="s2"&gt; &amp;amp; disown&amp;quot;&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</content><category term="wsl"></category><category term="story"></category><category term="wsl"></category><category term="linux"></category></entry></feed>