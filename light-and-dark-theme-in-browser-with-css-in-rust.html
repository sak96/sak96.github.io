<!doctype html><title>Light and Dark Theme in Browser with CSS in Rust</title><link rel="shortcut icon" href=https://sak96.github.io/theme/images/favicon.svg><meta content=width=device-width,initial-scale=1.0 name=viewport><meta charset=UTF-8><link href=https://sak96.github.io/feeds/all.atom.xml rel=alternate title=sak96-blog type=application/atom+xml><link href=https://sak96.github.io/theme/syntax/pygment.css rel=stylesheet><style>*{box-sizing:border-box}:root{--bg:#1d2021;--fg:#d4be98;--gray:#928374;--blue:#7daea3;--green:#a9b665;--red:#ea6962}[data-theme=light]{--bg:#f9f5d7;--fg:#654735;--gray:#928374;--blue:#45707a;--green:#6c782e;--red:#c14a4a}table,th,td{border:1px solid var(--fg);border-collapse:collapse;padding:10px}.codehilitetable{border:2px solid var(--blue);border-collapse:collapse;border-radius:4px;padding:0;font-family:monospace;display:block;overflow-x:auto}.codehilite{margin:0 1em}.linenos{text-align:right;border:0;border-right:2px solid var(--blue);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-khtml-user-select:none;padding:0 .5em}.code{border:0}body{background-color:var(--bg);color:var(--fg)}a{color:var(--blue);text-decoration:none}h1,h2,h3,h4,h5,h6{color:var(--green)}small{color:var(--gray)}.navbar{border-bottom:1px solid var(--green)}.navbar div{display:inline-block}.nav-end{position:absolute;right:.5rem}.navbar a{padding:.5rem 0}.navbar a:before{content:"["}.navbar a:after{content:"]"}#theme{cursor:pointer}[data-theme=light] #theme:before{content:"[ðŸŒš:"}#theme:before{content:"[ðŸŒž:"}#navbar-toggler{display:none}.content{width:80%;max-width:50rem;margin:auto}article em,article strong{color:var(--red)}.not-found,.coming-soon{text-align:center;width:100%;display:block}.item{border-top:1px dashed var(--red);color:var(--fg);margin:.5rem 0;padding:1rem;display:block}.item>:first-child{margin-top:0}.img-fluid{width:100%}.paginator{justify-content:space-between;margin:.5rem;display:flex}.footer,.tags{justify-content:center;margin:.5rem;display:flex}.disabled{pointer-events:none;color:var(--gray)}@media only screen and (width<=500px){.navbar{border:none}.nav-header{border-bottom:.025rem solid var(--green)}.navbar div{display:block;position:static}#navbar-toggler{background-color:inherit;color:inherit;border:none;display:inline;position:absolute;right:1rem;transform:rotate(90deg)}.navbar a:after,.navbar a:before{content:""}.navbar a{border-bottom:.025rem solid var(--green);display:none}.nav-header a{border:none;display:inline-block}.navbar a.show{display:block}.content{width:100%}.footer{display:inline-block}.paginator span{display:none}[data-theme=light] #theme:before{content:"ðŸŒš:"}#theme:before{content:"ðŸŒž:"}}</style><body><div class=navbar><div class=nav-header><a href=https://sak96.github.io/index.html>sak96-blog</a><a id=navbar-toggler>|||</a></div><div class=nav-start><a href=https://sak96.github.io/authors.html>Authors</a><a href=https://sak96.github.io/categories.html>Categories</a><a href=https://sak96.github.io/tags.html>Tags</a></div><div class=nav-end><a href=https://sak96.github.io/feeds/all.atom.xml>Atom</a><a id=theme>Theme</a></div></div><script>document.querySelector(`#navbar-toggler`).onclick=(a=>{document.querySelectorAll(`.nav-start a,.nav-end a`).forEach(a=>a.classList.toggle(`show`))});{let d=`data-theme`,e=`dark`,c=`light`,b=`theme`;let a=localStorage.getItem(b);if(a===c||window.matchMedia(`(prefers-color-scheme: light)`).matches){document.documentElement.setAttribute(d,c);localStorage.setItem(b,c)}else{document.documentElement.setAttribute(d,e);localStorage.setItem(b,e)}}document.querySelector(`#theme`).onclick=(a=>{let b=`data-theme`,d=`light`,c=`theme`;if(document.documentElement.getAttribute(b)){document.documentElement.setAttribute(b,``);localStorage.setItem(c,`dark`)}else{document.documentElement.setAttribute(b,d);localStorage.setItem(c,d)}})</script><div class=content><div><h1>Light and Dark Theme in Browser with CSS in Rust</h1><h5><p>This article walks-through implementing dark and light theme using css.</h5><h5>Read time: 5 min</h5><small>Written on March 28, 2023</small></div><div><article><p>I am a fan of dark theme, as brightness just hurts my eye. Hence I try to implement dark theme for apps that I build. (Not that I have build any popular apps.)<p>Most apps that I build these days are in rust. They usually end up being command line tools. As I find Building Graphical User Interface is hard in rust. Finally after trying out <a title="A Rust Desktop UI Framework" href=https://tauri.app/>tauri</a> and <a title="A Rust Web UI Framework" href=https://yew.rs/>yew</a> framework, I feel there is hope.<p>Basically TAURI is alternative to electron written in rust. And YEW is alternative rust framework to react.<p>So I built an app called <a title="A Time Tracker" href=https://github.com/sak96/time_tracker>time tracker</a> which tracks time. And I wanted dark theme but without any frameworks. I got stuck and could not see how to proceed so I had paused work on the app. But finally, I found out the tricks for building dark theme.<h2>The Dark Arts of Dark themes</h2><p>CSS is a large standard for styling, it has lot of stuff. Usually I learn new trick by browsing <code>stackoverflow</code> or <code>github</code> browsing. I found about <code>prefers-color-scheme</code> which would allow theming to system preference.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div><td class=code><div><pre><span></span><span class=p>:</span><span class=nd>root</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=nv>--c-bg</span><span class=p>:</span><span class=w> </span><span class=mh>#fff</span><span class=p>;</span>
<span class=w>  </span><span class=nv>--c-text</span><span class=p>:</span><span class=w> </span><span class=mh>#000</span><span class=p>;</span>
<span class=p>}</span>
<span class=p>@</span><span class=k>media</span><span class=w> </span><span class=o>(</span><span class=nt>prefers-color-scheme</span><span class=o>:</span><span class=w> </span><span class=nt>dark</span><span class=o>)</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=p>:</span><span class=nd>root</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nv>--c-bg</span><span class=p>:</span><span class=w> </span><span class=mh>#000</span><span class=p>;</span>
<span class=w>    </span><span class=nv>--c-text</span><span class=p>:</span><span class=w> </span><span class=mh>#fff</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
</pre></div></table></div><p>Based on users system preference the CSS color variables would be set. This could be used in the CSS styling for setting dark or light theme. This was fine, but the issue was the user could not toggle theme for particular app.<h2>Dark or Light is just data</h2><p>CSS selector provide way to select elements by data attributes. These attributes can be used to store information which are not actually part of HTML. We can store the theming information in here and toggle it to get desired result.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div><td class=code><div><pre><span></span><span class=o>[</span><span class=nt>data-theme</span><span class=o>=</span><span class=s2>"light"</span><span class=o>]</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=nv>--bg</span><span class=p>:</span><span class=w> </span><span class=mh>#1d2021</span><span class=p>;</span>
<span class=w>  </span><span class=nv>--fg</span><span class=p>:</span><span class=w> </span><span class=mh>#d4be98</span><span class=p>;</span>
<span class=p>}</span>
<span class=o>[</span><span class=nt>data-theme</span><span class=o>=</span><span class=s2>"light"</span><span class=o>]</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=nv>--bg</span><span class=p>:</span><span class=w> </span><span class=mh>#f9f5d7</span><span class=p>;</span>
<span class=w>  </span><span class=nv>--fg</span><span class=p>:</span><span class=w> </span><span class=mh>#654735</span><span class=p>;</span>
<span class=p>}</span>
</pre></div></table></div><p>The above provides color variables to element with data attribute <code>data-theme</code>. We can set <code>data-theme</code> to document element via JavaScript and toggle it. This change would make the color variables available to all the elements.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal>1</span></pre></div><td class=code><div><pre><span></span><span class=nb>document</span><span class=p>.</span><span class=nx>documentElement</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>"data-theme"</span><span class=p>,</span><span class=w> </span><span class=s2>"dark"</span><span class=p>);</span>
</pre></div></table></div><p>You can set default to system preference and later toggle when user asks. To get the system preference media queries can be used.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal>1</span></pre></div><td class=code><div><pre><span></span><span class=nx>is_system_preference_dark</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>window</span><span class=p>.</span><span class=nx>matchMedia</span><span class=p>(</span><span class=s2>"(prefers-color-scheme: light)"</span><span class=p>).</span><span class=nx>matches</span><span class=p>;</span>
</pre></div></table></div><p>This is actually how this blog handles the theming. But this approach requires setting <code>background-color</code> and <code>color</code> properly to elements. When building app avoiding CSS framework it would be nice to utilize system colors, and change only app specific colors (like color for dangerous delete button) based on data attributes.<h2>Only required colors, please!</h2><p>For technical specification for CSS I refer to <a title="Mozilla Developer Network" href=https://developer.mozilla.org/en-US/docs/Web/CSS>MDN</a>. And I stumbled across <code>color-scheme</code> which allows elements to declare there preference. There is <a title="Meta tag for color-scheme" href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta/name>color scheme meta tag</a> which can also be set to apply it for whole document.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal>1</span></pre></div><td class=code><div><pre><span></span><span class=o><</span><span class=nt>meta</span><span class=w> </span><span class=nt>name</span><span class=o>=</span><span class=s2>"color-scheme"</span><span class=w> </span><span class=nt>content</span><span class=o>=</span><span class=s2>"dark light"</span><span class=o>></span>
</pre></div></table></div><p>This attribute can be toggle using JavaScript to change the theme mode. The elements use their default colors for background and font based on color scheme.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal>1</span></pre></div><td class=code><div><pre><span></span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>"meta"</span><span class=p>).</span><span class=nx>namedItem</span><span class=p>(</span><span class=s2>"color-scheme"</span><span class=p>).</span><span class=nx>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>"dark"</span><span class=p>;</span>
</pre></div></table></div><p>In some edge case you might want to reuse the default colors say for background. Hard coding does not cut it, the background color might be effected by system settings. Instead utilize system colors, this avoids hard coding of colors.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div><td class=code><div><pre><span></span><span class=na>.remove-transparent</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=cm>/*</span>
<span class=cm>        adding class to element with "background-color: transparent;"</span>
<span class=cm>        removes it's transparency.</span>
<span class=cm>    */</span>
<span class=w>    </span><span class=nl>background-color:</span><span class=w> </span><span class=nf>Canvas</span><span class=c1>;</span>
<span class=err>}</span>
</pre></div></table></div><h2>What is the rusty way ?</h2><p>This is all great but how to do it in rust? The theming requires interacting with browser, which is done through <a title="Wasm Bind Gen" href=https://rustwasm.github.io/docs/wasm-bindgen/>wasmbindgen</a>. The easiest way would be to write JavaScript code and expose it to rust. This can be done using <a title="Inline java-script in rust" href=https://rustwasm.github.io/docs/wasm-bindgen/reference/js-snippets.html>inline</a> technique provided by the library.<div class=codehilite><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span></pre></div><td class=code><div><pre><span></span><span class=cp>#[wasm_bindgen(inline_js = r#</span><span class=s>"</span>
<span class=s>  export function setDarkTheme() {</span>
<span class=s>      document.getElementsByTagName('meta').namedItem('color-scheme').content = 'dark';</span>
<span class=s>      document.documentElement.setAttribute('data-theme', 'light');</span>
<span class=s>  }</span>
<span class=s>"</span><span class=cp>#)]</span>
<span class=k>extern</span><span class=w> </span><span class=s>"C"</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>setDarkTheme</span><span class=p>();</span>
<span class=p>}</span>

<span class=c1>//  in toggle function ..</span>
<span class=n>setDarkTheme</span><span class=p>();</span>
<span class=p>}</span>
</pre></div></table></div><h2>Resources</h2><ul><li><a href=https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme>prefers color scheme</a><li><a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/data-*>data attributes</a><li><a href=https://developer.mozilla.org/en-US/docs/Web/CSS/color-scheme>color scheme</a><li><a href=https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries>media queries</a><li><a title="System colors" href=https://developer.mozilla.org/en-US/docs/Web/CSS/system-color>system color</a><li><a title="Meta tag for color-scheme" href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta/name>color scheme meta tag</a></ul></article></div><div class=tags><span>Post Tags:</span><a href=tag/css.html>Â #css,</a><a href=tag/theme.html>Â #theme,</a><a href=tag/html.html>Â #html,</a><a href=tag/dark.html>Â #dark,</a><a href=tag/rust.html>Â #rust</a></div><hr class=my-3><div id=comments></div><script>var PopulateComment=(a=>{let e=`div`,f=`a`,g=`item`;commentsBlock=document.getElementById(`comments`);let b=document.createElement(e);b.innerText=`Comments`;commentsBlock.append(b);let c=document.createElement(e);commentsBlock.append(c);a.forEach(a=>{let b=document.createElement(`span`);b.innerText=a.user.login;updateTime=document.createElement(`small`);updateTime.innerText=`(`+ a.updated_at+ `)`;commentBody=document.createElement(e);commentBody.innerText=a.body;lineBreak=document.createElement(`br`);commentBox=document.createElement(f);commentBox.classList.add(g);commentBox.append(b);commentBox.append(updateTime);commentBox.append(lineBreak);commentBox.append(commentBody);commentBox.href=a.html_url;c.append(commentBox)});let d=document.createElement(f);d.classList.add(g);d.href=issueUrl;d.innerText=`Have some comments? Add comment ...`;c.append(d)});let commentUrl=`https://api.github.com/repos/sak96/sak96.github.io/issues/15/comments`;let issueUrl=`https://github.com/sak96/sak96.github.io/issues/15`;var xhr=new XMLHttpRequest();xhr.open(`GET`,commentUrl,!0);xhr.responseType=`json`;xhr.onload=(()=>{var a=xhr.status;if(a===200){console.log(PopulateComment(xhr.response))}else{console.log(xhr.response)}});xhr.send()</script><script src=https://unpkg.com/mermaid@latest/dist/mermaid.min.js></script><hr><div class=footer><span>Powered by:</span><a href=http://getpelican.com/>Pelican,</a><a href=https://github.com/pygments/pygments>Pygments,</a><a href=https://github.com/morhetz/gruvbox-contrib>Gruvbox</a></div></div>